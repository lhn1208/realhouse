!function(N){N.fn.prettyDropdown=function(f){(f=N.extend({classic:!1,customClass:"arrow",width:null,height:50,hoverIntent:200,multiDelimiter:"; ",multiVerbosity:99,selectedMarker:"&#10003;",afterLoad:function(){}},f)).selectedMarker='<span aria-hidden="true" class="checked"> '+f.selectedMarker+"</span>",isNaN(f.width)&&!/^\d+%$/.test(f.width)&&(f.width=null),isNaN(f.height)?f.height=50:f.height<8&&(f.height=8),(isNaN(f.hoverIntent)||f.hoverIntent<0)&&(f.hoverIntent=200),isNaN(f.multiVerbosity)&&(f.multiVerbosity=99);var c,v,h,u,p,g,m=["0","1","2","3","4","5","6","7","8","9",,,,,,,,"a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],t=function(e){var t,n=N(e),o=e.size,a=e.name||e.id||"";if(!n.data("loaded")){if(n.data("size",o).removeAttr("size"),n.css("visibility","hidden").outerHeight(f.height),g=+new Date,e.id){var i=N("label[for="+e.id+"]");i.length&&(i.attr("id")&&!/^menu\d{13,}$/.test(i.attr("id"))?t=i.attr("id"):i.attr("id",t="menu"+g))}v=0;var s=N("optgroup, option",n),r=s.filter(":selected"),c=e.multiple,l="<ul"+(e.disabled?"":' tabindex="0"')+' role="listbox"'+(e.title?' title="'+e.title+'" aria-label="'+e.title+'"':"")+(t?' aria-labelledby="'+t+'"':"")+' aria-activedescendant="item'+g+'-1" aria-expanded="false" style="max-height:'+(f.height-2)+"px;margin:"+n.css("margin-top")+" "+n.css("margin-right")+" "+n.css("margin-bottom")+" "+n.css("margin-left")+';">';c?(l+=y(null,"selected"),s.each(function(){this.selected?l+=y(this,"",!0):l+=y(this)})):f.classic?s.each(function(){l+=y(this)}):(l+=y(r[0],"selected"),s.filter(":not(:selected)").each(function(){l+=y(this)})),l+="</ul>",n.wrap("<div "+(a?'id="prettydropdown-'+a+'" ':"")+'class="prettydropdown '+(f.classic?"classic ":"")+(e.disabled?"disabled ":"")+(c?"multiple ":"")+f.customClass+' loading"'+(c||1<o?' style="height:'+f.height+'px;"':"")+"></div>").before(l).data("loaded",!0);var d,h=n.parent().children("ul"),u=h.outerWidth(!0);if(s=h.children(),c?T(h):f.classic&&N('[data-value="'+r.val()+'"]',h).addClass("selected").append(f.selectedMarker),h.width()<=0){var p=h.parent().clone().css({position:"absolute",top:"-100%"});N("body").append(p),u=p.children("ul").outerWidth(!0),N("li",p).width(u),d=p.children("ul").outerWidth(!0),p.remove()}s.width(u).css("width",s.css("width")),f.width&&(h.parent().css("min-width",s.css("width")),h.css("width","100%"),s.css("width","100%")),s.click(function(){var e=N(this),t=h.children(".selected");if(!h.parent().hasClass("disabled"))if(!h.hasClass("active")||e.hasClass("disabled")||e.hasClass("label")||e.data("value")===t.data("value")||(c?(e.children("span.checked").length?e.children("span.checked").remove():e.append(f.selectedMarker),h.children(":not(.selected)").each(function(e){N("optgroup, option",n).eq(e).prop("selected",0<N(this).children("span.checked").length)}),T(h)):(t.removeClass("selected").children("span.checked").remove(),e.addClass("selected").append(f.selectedMarker),f.classic||h.prepend(e),h.removeClass("reverse").attr("aria-activedescendant",e.attr("id")),t.data("group")&&!f.classic&&h.children(".label").filter(function(){return N(this).text()===t.data("group")}).after(t),N("optgroup, option",n).filter(function(){return this.value==e.data("value")||this.text===e.contents().filter(function(){return 3===this.nodeType}).text()}).prop("selected",!0)),n.trigger("change")),!e.hasClass("selected")&&c||(h.toggleClass("active"),h.attr("aria-expanded",h.hasClass("active"))),h.hasClass("active")){1<N(".prettydropdown > ul.active").length&&x(N(".prettydropdown > ul.active").not(h)[0]);var a,i=window.innerHeight,s=h.offset().top,r=N(document).scrollTop(),l=h.outerHeight();o&&(a=o*(f.height-2))<l-2&&(l=a+2);var d=s-r+l;i<d&&(s-r>i-(s-r+f.height)?(h.addClass("reverse"),f.classic||h.append(t),s-r+f.height<l&&(h.outerHeight(s-r+f.height),h.scrollTop(l))):h.height(h.height()-(d-i))),a&&a<h.height()&&h.css("height",a+"px"),f.classic&&h.scrollTop(t.index()*(f.height-2))}else h.data("clicked",!0),x(h[0])}),h.on({focusin:function(){N(window).off("keydown",w).on("keydown",w)},focusout:function(){N(window).off("keydown",w)},mouseenter:function(){h.data("hover",!0)},mouseleave:x,mousemove:k}),t&&N("#"+t).off("click",b).click(b),h.parent().width(f.width||d||h.outerWidth(!0)).removeClass("loading"),f.afterLoad()}},b=function(e){N("ul[aria-labelledby="+e.target.id+"]").focus()},w=function(e){var t=N(".prettydropdown > ul.active, .prettydropdown > ul:focus");if(t.length)if(9!==e.which){e.preventDefault(),e.stopPropagation();var a,i=t.children(),s=t.hasClass("active"),r=t.height()/(f.height-2),l=r%1<.5?Math.floor(r):Math.ceil(r);switch(h=Math.max(0,t.children(".hover").index()),u=i.length-1,c=i.eq(h),t.data("lastKeypress",+new Date),e.which){case 13:s||(c=i.filter(".selected"),C(c,1)),c.click();break;case 27:s&&x(t[0]);break;case 32:s?a=" ":(c=i.filter(".selected"),C(c,1),c.click());break;case 33:s&&(C(c,0),C(i.eq(Math.max(h-l-1,0)),1));break;case 34:s&&(C(c,0),C(i.eq(Math.min(h+l-1,u)),1));break;case 35:s&&(C(c,0),C(i.eq(u),1));break;case 36:s&&(C(c,0),C(i.eq(0),1));break;case 38:s&&(C(c,0),C(h?i.eq(h-1):i.eq(u),1));break;case 40:s&&(C(c,0),C(h===u?i.eq(0):i.eq(h+1),1));break;default:s&&(a=m[e.which-48])}if(a){clearTimeout(p),t.data("keysPressed",void 0===t.data("keysPressed")?a:t.data("keysPressed")+a),p=setTimeout(function(){t.removeData("keysPressed")},300);var d=[],n=c.index();if(i.each(function(e){0===N(this).text().toLowerCase().indexOf(t.data("keysPressed"))&&d.push(e)}),d.length)for(var o=0;o<d.length;++o){if(d[o]>n){C(i,0),C(i.eq(d[o]),1);break}o===d.length-1&&(C(i,0),C(i.eq(d[0]),1))}}}else x(t[0])},k=function(e){var t=N(e.currentTarget);"LI"!==e.target.nodeName||!t.hasClass("active")||new Date-t.data("lastKeypress")<200||(C(t.children(),0,1),C(N(e.target),1,1))},y=function(e,t,a){var i,s="",r="";if(t=t||"",e){switch(e.nodeName){case"OPTION":"OPTGROUP"===e.parentNode.nodeName&&(s=e.parentNode.getAttribute("label")),r=(e.getAttribute("data-prefix")||"")+e.text+(e.getAttribute("data-suffix")||"");break;case"OPTGROUP":t+=" label",r=(e.getAttribute("data-prefix")||"")+e.getAttribute("label")+(e.getAttribute("data-suffix")||"")}(e.disabled||s&&e.parentNode.disabled)&&(t+=" disabled"),i=e.title,s&&!i&&(i=e.parentNode.title)}return'<li id="item'+g+"-"+ ++v+'"'+(s?' data-group="'+s+'"':"")+(e&&(e.value||f.classic)?' data-value="'+e.value+'"':"")+(e&&"OPTION"===e.nodeName?' role="option"':"")+(i?' title="'+i+'" aria-label="'+i+'"':"")+(t?' class="'+N.trim(t)+'"':"")+(50!==f.height?' style="height:'+(f.height-2)+"px;line-height:"+(f.height-4)+'px;"':"")+">"+r+(a||"selected"===t?f.selectedMarker:"")+"</li>"},x=function(e){var t=N(e.currentTarget||e);"mouseleave"!==e.type||t.hasClass("active")||t.data("clicked")||(t=N(".prettydropdown > ul.active")),t.data("hover",!1),clearTimeout(p),p=setTimeout(function(){t.data("hover")||(t.hasClass("reverse")&&!f.classic&&t.prepend(t.children(":last-child")),t.removeClass("active reverse").removeData("clicked").attr("aria-expanded","false").css("height",""),t.children().removeClass("hover nohover"))},"mouseleave"!==e.type||t.data("clicked")?0:f.hoverIntent)},C=function(e,t,a){if(t){if(e.removeClass("nohover").addClass("hover"),1===e.length&&c&&!a){var i=e.parent(),s=i.outerHeight(),r=e.offset().top-i.offset().top-1;0===e.index()?i.scrollTop(0):e.index()===u?i.scrollTop(i.children().length*f.height):r+f.height>s?i.scrollTop(i.scrollTop()+f.height+r-s):r<0&&i.scrollTop(i.scrollTop()+r)}}else e.removeClass("hover").addClass("nohover")},T=function(e){var t,a=e.parent().children("select"),i=N("option",a).map(function(){if(this.selected)return this.text}).get();if(t=f.multiVerbosity>=i.length?i.join(f.multiDelimiter)||"None selected":i.length+"/"+N("option",a).length+" selected"){var s=(a.attr("title")?a.attr("title"):"")+(i.length?"\nSelected: "+i.join(f.multiDelimiter):"");e.children(".selected").text(t),e.attr({title:s,"aria-label":s})}else e.children(".selected").empty(),e.attr({title:a.attr("title"),"aria-label":a.attr("title")})};return this.refresh=function(e){return this.each(function(){var e=N(this);e.prevAll("ul").remove(),e.unwrap().data("loaded",!1),this.size=e.data("size"),t(this)})},this.each(function(){t(this)})}}(jQuery);